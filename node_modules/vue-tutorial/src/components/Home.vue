<template>
   <div  id="demo">
   <div class = "a"><h1>引擎区</h1></div>
   
   <div class="head" >
        <template v-for="branch in branches">
            <input type="radio"
            :id="branch"
            :value="branch"
            name="branch"
            v-model="currentBranch">
            <label :for="branch">{{ branch }}</label>&nbsp;&nbsp;
        </template>
	</div>
  ----------------------------------------------
	<div class = "a">图形区:</div>
	<div class="tu">
  <div>
    <genre-select v-model="chartInfo" :branch="currentBranch"></genre-select>
    <toggle-button :disabled="currentBranch=='HighChart'||currentBranch=='EChart'" :value="false" color="#82C7EB" :sync="true" :labels="true" @change="is3D = $event.value" /> 3D效果
  </div>
<div>
<select id="themes-select" v-model="theme" data-style="btn-md" data-width="150" tabindex="-98" class="select show-tick">
		    <option value="defaultTheme|defaultPalette" selected="selected">Default</option>
            <option value="darkBlue|blue" data-palette-value="blue">Dark Blue</option>
            <option value="lightBlue|blue">Light Blue</option>
            <option value="darkEarth|earth">Dark Earth</option>
            <option value="lightEarth|earth">Light Earth</option>
            <option value="darkGlamour|glamour">Dark Glamour</option>
            <option value="lightGlamour|glamour">Light Glamour</option>
            <option value="darkProvence|provence">Dark Provence</option>
            <option value="lightProvence|provence">Light Provence</option>
            <option value="darkTurquoise|turquoise">Dark Turquoise</option>
            <option value="lightTurquoise|turquoise">Light Turquoise</option>
            <option value="coffee|coffee">Coffee</option>
            <option value="monochrome|monochrome">Monochrome</option>
            <option value="morning|morning">Morning</option>
            <option value="pastel|pastel">Pastel</option>
            <option value="sea|sea">Sea</option>
            <option value="wines|wines">Wines</option>
           
        </select>

  
        <select id="palettes-select" v-model="palette" class="select show-tick" data-style="btn-md" data-width="150" tabindex="-98">
            <option value="defaultPalette" selected="selected">Default</option>
            <option value="blue">Blue</option>
            <option value="earth">Earth</option>
            <option value="glamour">Glamour</option>
            <option value="provence">Provence</option>
            <option value="turquoise">Turquoise</option>
            <option value="coffee">Coffee</option>
            <option value="monochrome">Monochrome</option>
            <option value="morning">Morning</option>
            <option value="pastel">Pastel</option>
            <option value="sea">Sea</option>
            <option value="wines">Wines</option>
           
        </select>
</div>
----------------------------------------------
<div >属性区:</div>
<section>

    <ul>
      <li v-for="prop in props">
      <label  for="">{{prop.cname}}</label>
        <input class="edit" type="text"  v-model="prop.value" >
      </li>
    </ul>

     </section>
	</div>
----------------------------------------------
<div >主题区:</div>
<div>
<template>
 <select v-model="selected">
 <option v-for="option in options" v-bind:value="option.value" selected>
  {{option.text}}
 </option>
 </select>
</template>
</div>

----------------------------------------------
<div >图形主题（目前只适用HighChart）:</div>
<div>
<template>
 <select v-model="chartSelected">
 <option v-for="option in chartOptions" v-bind:value="option.value" selected>
  {{option.text}}
 </option>
 </select>
</template>
</div>

----------------------------------------------
<div id="container" style="height:300px;width:50%"></div>

</div>
</template>
<!-- <style id="cssTheme" src='../css/themeDark.css' type="text/css" accesskey="cssTheme"></style> -->
<!-- <link href="../css/themeNormal.css" rel="stylesheet" type="text/css" id="css"/> -->
<script>
import GenreSelect  from './Select.vue'
	export default {
        name : 'Home',
		    data() {
				return {
					chartInfo: '',
					branches: ['AnyChart', 'HighChart', 'EChart'],
					currentBranch: 'AnyChart',
					chartJson:{},
					props:{},
					ready:false,
					currentGenre: 'bar',
					is3D:false,
					ifhighchart:false,
					theme:"defaultTheme|defaultPalette",
					palette:"defaultPalette",
					isShow:true,
					options: [
							{ text: '默认主题', value: 'normal' },
							{ text: '浅色主题', value: 'dark' },
						],
					chartOptions: [
						{ text: '绿色主题', value: 'dark-green' },
						{ text: '蓝色主题', value: 'dark-blue' },
					],
					selected:'normal',
					chartSelected:'dark-green',
					}
        },
		  components: {
				GenreSelect,VueMarquee
    	},
		created: function() {
			this.initialChart();
			this.setEngine();
			this.getJsonInfo();
		},
		watch: {
			currentGenre: {
				handler: function (type) {
					this.drawChart();
				},
			},
			is3D: {
				handler: function (type) {
					this.drawChart();
				},
			},
			isSeries: {
				handler: function (type) {
					this.drawChart();
				},
			},
			props: {
			handler: function (props) {
				console.log("props")
					this.$store.state.props = props;
					//this.$store.dispatch('drawChart',this.currentBranch)
				    this.drawChart();
			},
			deep: true
			},
			currentBranch: {
				handler:function(currentBranch){
					if(currentBranch!="AnyChart"){
  						$("#themes-select").hide();
		  				$("#palettes-select").hide();				
					}else{
					 	$("#themes-select").show();
		 				 $("#palettes-select").show();			
					}
					this.drawChart();
				}
			},
			chartInfo: {
				handler: function (chartInfo) {
					this.drawChart();
				},
				deep: true
			},
			  selected: function(val) {
			      if(val == 'normal'){
			        //alert("默认主题")
			        var obj = document.getElementById("cssTheme");
			        obj.setAttribute("href","static/themeNormal.css");
			      }else{
			        //alert("深色主题")
			        var obj = document.getElementById("cssTheme");
			        obj.setAttribute("href","static/themeDark.css");

			      }
			      },
			  	theme: {
					handler: function (type) {
						this.palette = this.theme.split("|")[1];
						this.$store.state.theme = this.theme;
						this.$store.state.palette = this.palette;
						this.drawChart();
					},
				},
				palette: {
					handler: function (type) {
					this.$store.state.palette = this.palette;
					this.$store.dispatch('changePalette');
					},
				},
			    chartSelected: function(val) {
			      if(val == 'dark-green'){
			        //alert("a");
			        // var obj = document.getElementById("chartTheme");
			        // obj.setAttribute("src","static/dark-green.js");
			        jQuery.ajax({
			          url: "static/dark-green.js",
			          dataType: "script",
			          cache: true
			        }).done(function() {
			          jQuery.cookie("cookie_name", "value", { expires: 7 });
			        });
			      }else{
			        //alert("b");
			        // var obj = document.getElementById("chartTheme");
			        // obj.setAttribute("src","static/dark-blue.js");
			        jQuery.ajax({
			          url: "static/dark-blue.js",
			          dataType: "script",
			          cache: true
			        }).done(function() {
			          jQuery.cookie("cookie_name", "value", { expires: 7 });
			        });

			      }
			      this.drawChart();
			    }
		
		},

		methods: {
			//获取属性值
			getJsonInfo: function() {
				this.$http.get('static/attributes.json').then(function(response){
					var resdata = response.data
					this.$store.state.props = resdata;
					this.props = resdata
					console.log("getJsonInfo")
					
				}).catch(function(response){
					console.log(response)
				})
			},
			setEngine:function(){
				this.$store.state.type = this.currentBranch;
				this.$store.dispatch('setEngine')
			},
			drawChart:function(){
					this.$store.state.genre = this.currentGenre;
					this.$store.state.engine = this.currentBranch;
					this.$store.state.chartInfo = this.chartInfo;
					this.$store.state.is3D = this.is3D;
					//this.$store.state.isSeries = this.isSeries;
					//this.$store.state.props = this.props;
					this.$store.state.theme = this.theme;
					this.$store.state.palette = this.palette;

					this.$store.dispatch('drawChart');
					//this.$store.dispatch('changePalette');
			},
			initialChart:function(){
				this.$store.dispatch('initial',this.currentBranch)
			},
			fetchData:function(){
				//alert("fetchData");
				//this.currentBranch="anychart"
				//this.getChartJson(this.currentBranch)
				//this.drawChart();
			},

		},


    }


</script>
