<template>
  <div>
    <select v-model="selectedChart" name="chart">
      <option v-for="(item, index) in charts"
        v-if="getGenre(item)"
        :value="item">
        {{ item.name }}
      </option>
    </select>
    <select v-model="selectedSubChart" name="type">
      <option
        v-for="(item, index) in subCharts"
        :value="item"
        v-if="getSubGenre(item)"
        >
        {{ item.name }}
      </option>
    </select>
  </div>
</template>

<script>
/**
 * 联动选择器
*/
import charts from '../../static/charts.js'
import Vue from 'vue'
export default {
  name: 'app',
  props: ['branch'],
  created() {
    // 数据初始化,默认选中柱图,默认选中第一个
    let bar = this.charts.slice(0,7)
    this.subCharts = bar.filter(item => {
      if (item.level === 2) {
        return true
      }
    })
    this.selectedSubChart = this.subCharts[0]
  },
  methods:{
      getGenre: function(item) {
        var isLevel = item.level === 1;
        var isType = !item.except || (item.except&&(item.except.indexOf(this.branch)==-1));
        var result = isLevel && isType;
        return result;
      },
      getSubGenre: function(item) {
        var isLevel = item.level === 2;
        var isType = !item.except || (item.except&&(item.except.indexOf(this.branch)==-1));
        var result = isLevel && isType;
        return result;
      },
  },
  watch: {
    selectedChart(newVal, oldVal) {
      //特殊处理
     // if (newVal.sheng === '71' || newVal.sheng === '81' || newVal.sheng === '82') {
     //   this.cities = [newVal]
     //   this.blocks = [newVal]
     // } else {
        this.subCharts = this.charts.filter(item => {
          if (item.level === 2 && item.chart && newVal.chart === item.chart) {
            return true
          }
        })
     // }
      var _this = this
      // 此时在渲染DOM,渲染结束之后再选中第一个
      Vue.nextTick(() => {
        _this.selectedSubChart = _this.subCharts[0]
        _this.$emit('input', _this.info)
      })
    },

    selectedSubChart(newVal) {
      // 选择了一个图形,要选择种类了 type是种类的代表
     // if (newVal.sheng === '71' || newVal.sheng === '81' || newVal.sheng === '82') {
       // this.blocks = [newVal]
      //  this.cities = [newVal]
      //} else {
       // this.blocks = this.provinces.filter(item => {
       //   if (item.level === 3 && item.sheng && item.sheng == newVal.sheng && item.di === newVal.di && item.name !== '市辖区') {
       //     return true
       //   }
       // })
      //}
      var _this = this
      Vue.nextTick(() => {
        
//_this.selectedType = newVal
        // 触发与 v-model相关的 input事件
        _this.$emit('input', _this.info)
      })
    }
  },
  computed: {
    info() {
      return {
        chart: this.selectedChart,
        subChart: this.selectedSubChart,
      
      }
    }
  },
  data() {
      return {
        selectedChart: charts[0],
        selectedSubChart: 0,
        subCharts: 0,
        charts,
      }
    }
}
</script>
